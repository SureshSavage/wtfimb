{% extends "layout.html" %}

{% block script %}
var lat=13.0456
var lon=80.232
var zoom=12
var iconSize = new OpenLayers.Size(22,22);
var iconOffset = new OpenLayers.Pixel(-(iconSize.w/2), -iconSize.h);
var iconSize = new OpenLayers.Size(22,22);
var iconOffset = new OpenLayers.Pixel(-(iconSize.w/2), -iconSize.h);
var icon = new OpenLayers.Icon("/static/img/bus_stop_22.png",iconSize,iconOffset);
var map;
$(document).ready(function() {
            map = new OpenLayers.Map ("map", {
                controls:[
                    new OpenLayers.Control.Navigation(),
                    new OpenLayers.Control.PanZoomBar(),
                    new OpenLayers.Control.Attribution(),
                    new OpenLayers.Control.LayerSwitcher()],
                maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
                maxResolution: 156543.0399,
                numZoomLevels: 19,
                units: 'm',
                projection: new OpenLayers.Projection("EPSG:900913"),
                displayProjection: new OpenLayers.Projection("EPSG:4326")
            } );
            var layerMapnik = new OpenLayers.Layer.OSM.Mapnik("Chennai");
            var layerStages = new OpenLayers.Layer.Markers("Stages");
            map.addLayer(layerMapnik);
            map.addLayer(layerStages);
            {% if stage.latitude %}
              lat = {{ stage.latitude }};
              lon = {{ stage.longitude }};
              var lonLat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
              var marker = new OpenLayers.Marker(lonLat,icon.clone());
              layerStages.addMarker(marker);
              zoom = 17;
            {% endif %}
            var lonLat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject());
            map.setCenter (lonLat, zoom);
	});
{% endblock %}

{% block title %}
Bus Stage: {{ stage.display_name }} 
{% endblock %}

{% block main %}
<span>Route Name: {{ stage.display_name }}</span>
{% if not stage.latitude %}
	<span>
		<a class="mapthis" href="{% url edit.views.edit_stage stage.id %}">Map this Stage!</a>
	</span>
{% endif %}
<table id="outer">
  <tbody>
    <tr>
      <td width="30%">
      <table id="stages">
	<tr>
		<th>Route</th>
		<th>From</th>
		<th>To</th>
	</tr>
	{% for r in stage.route_set.all %}
	<tr class='route_entry'>
		<td> <a href="{% url view.views.show_route r.id %}">{{ r.display_name }}</a></td>
		<td> <a href="{% url view.views.show_stage r.start.id %}">{{ r.start.display_name }}</a></td>
		<td> <a href="{% url view.views.show_stage r.end.id %}">{{ r.end.display_name }}</a></td>
	</tr>	
	{% endfor %}
      </table>
      </td>
      <td width="70%">
        <div id="map"></div>
      </td>
   </tbody>
</table>
{% endblock %}
